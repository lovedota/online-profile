define(["durandal/system","durandal/composition","jquery"],function(e,t,n){function i(e,t){e.classList.remove(t?"entrance-in-fade":"entrance-in"),e.classList.remove("entrance-out")}var r=100,o={left:"0px",opacity:1},a={left:"",top:"",right:"",bottom:"",position:"",opacity:""},s=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/MSIE/),u=!1,l="Webkit Moz O ms Khtml".split(" "),c=document.createElement("div");if(void 0!==c.style.animationName&&(u=!0),!u)for(var d=0;d<l.length;d++)if(void 0!==c.style[l[d]+"AnimationName"]){u=!0;break}u?s?e.log("Using CSS3/jQuery mixed animations."):e.log("Using CSS3 animations."):e.log("Using jQuery animations.");var f=function(t){return e.defer(function(e){function l(){e.resolve()}function c(){t.keepScrollPosition||n(document).scrollTop(0)}function d(){c(),t.triggerAttach(),u?(i(t.child,h),t.child.classList.add(h?"entrance-in-fade":"entrance-in"),setTimeout(function(){i(t.child,h),t.activeView&&i(t.activeView,h),p.css(a),l()},f)):p.animate(o,{duration:f,easing:"swing",always:function(){p.css(a),l()}})}if(t.child){var f=t.duration||500,p=n(t.child),h=!!t.fadeOnly,g={display:"block",opacity:0,position:"absolute",left:h||u?"0px":"20px",right:0,top:0,bottom:0};p.css(g),t.activeView?u&&!s?(i(t.activeView,h),t.activeView.classList.add("entrance-out"),setTimeout(d,r)):n(t.activeView).fadeOut({duration:r,always:d}):d()}else n(t.activeView).fadeOut(r,l)}).promise()};return f});